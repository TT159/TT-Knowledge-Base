---
date: 2025-08-07
---
ä»ä¸Šæ¬¡week6 docå¼€å®Œä¼š (7.25å·å·¦å³ï¼‰ï¼Œä¼‘æ¯äº†å¾ˆä¹…ï¼Œä¸€ç›´æ²¡æœ‰å†™ä»£ç äº†ã€‚å·®ä¸å¤šä¼‘æ¯äº†ä¸¤å‘¨ã€‚

```Python
from spacy.lang.en import English

# ä»…åŠ è½½ tokenizer + sentence segmenterï¼Œä¸åŠ è½½ POS/NER ç­‰
nlp = English()
nlp.add_pipe("sentencizer") Â # åªåŠ è½½åˆ†å¥å™¨
```

```Python
# åŠ è½½é¢„è®­ç»ƒçš„ SpaCy æ¨¡å‹ï¼Œen_core_web_smï¼Œç„¶åå°†æ–‡ç« åŠ è½½åˆ° SpaCy çš„ NLP ç®¡é“ä¸­ã€‚
nlp = spacy.load("en_core_web_sm")
# python -m spacy download en_core_web_sm

```

|ç‰¹æ€§|**æ–¹å¼ä¸€ï¼š`spacy.load("en_core_web_sm")`**|**æ–¹å¼äºŒï¼š`English() + sentencizer`**|
|---|---|---|
|æ˜¯å¦åŠ è½½å®Œæ•´ NLP ç®¡é“|âœ… æ˜¯ï¼ˆå« tokenizer, tagger, parser, NER ç­‰ï¼‰|âŒ å¦ï¼ŒåªåŠ è½½ tokenizer + åˆ†å¥å™¨|
|åˆ†å¥ä¾æ®|âœ… åŸºäºä¾å­˜å¥æ³•ï¼ˆæ›´å‡†ç¡®ï¼‰|âš ï¸ åŸºäºæ ‡ç‚¹å’Œè§„åˆ™ï¼ˆå‡†ç¡®åº¦è¾ƒä½ï¼‰|
|æ˜¯å¦èƒ½å¤„ç†ç¼©å†™ã€çœç•¥å·ã€å¤æ‚æ ‡ç‚¹ç­‰|âœ… å¯ä»¥ï¼ˆä¾é ä¾å­˜å…³ç³»åˆ¤æ–­ï¼‰|âŒ æœ‰å¯èƒ½è¯¯åˆ†æˆ–æ¼åˆ†|
|å¤„ç†é€Ÿåº¦|âŒ è¾ƒæ…¢|âœ… æå¿«|
|å ç”¨å†…å­˜|âŒ è¾ƒé«˜ï¼ˆå› åŠ è½½ tagger/parser/nerï¼‰|âœ… æä½|
|æ˜¯å¦éœ€è¦é¢å¤–ä¸‹è½½æ¨¡å‹|âœ… æ˜¯ï¼Œéœ€è¦ `python -m spacy download en_core_web_sm`|âœ… ä¸éœ€è¦|
|é€‚åˆåœºæ™¯|é«˜è´¨é‡è¯­ä¹‰åˆ†æï¼ˆå¦‚æŠ½å–ä¸»è°“å®¾ï¼‰|å¿«é€Ÿåˆ†å¥ã€ä¸åšæ·±åº¦ NLP åˆ†æ|
|å®‰è£…å¤§å°|ğŸ”º å¤šï¼ˆ~40MBï¼‰|ğŸ”» å°‘ï¼ˆåªæœ‰ spaCy æœ¬èº«ï¼‰|


ä»Šå¤©å®Œæˆäº†3ä¸ªä¿®æ”¹ã€‚
1ï¼Œè§£å†³é‡‡æ ·çš„å¥å­è¿‡çŸ­ï¼Œä¸æ„æˆå®Œæ•´å¥å­çš„é—®é¢˜ã€‚
2ï¼Œå¯¹äºå¥å­æå–å‡½æ•°ï¼ŒAFFå¥å­å€™é€‰åˆ—è¡¨ï¼Œè¿›è¡ŒrandomæŒ‘é€‰ï¼Œè€Œä¸æ˜¯sequentialæŒ‘é€‰ï¼Œå°½å¯èƒ½é¿å…(s1, s2), (s2, s3)è¿™ç§é—®é¢˜ã€‚AFFè¡¥å…¨å‡½æ•°ï¼Œé‡‡ç”¨è·³æ­¥é‡‡æ ·ï¼Œæ­¥é•¿ä¸º2ï¼Œæ‰€ä»¥æ˜¯(s1, s2), (s3, s4)
3ï¼Œç»™æå–å‡½æ•°ï¼ŒAFFè¡¥å…¨å‡½æ•°åŠ ä¸Šè­¦ç¤ºè¯­å¥ã€‚

ç¬¬1æ­¥ï¼Œè¿›è¡Œä»¥åæ²¡è§åˆ°æ ‡é¢˜è¢«è¯¯è®¤ä¸ºå¥å­äº†ã€‚
ç¬¬2æ­¥ï¼Œè¿›è¡Œä»¥åoverlapå¤§å¹…å‡å°‘ï¼Œä»488/1000å‡å°‘åˆ°14/300


å¯¹single-word, multi-wordè¿›è¡Œäº†300ä¸ªæ ·æœ¬çš„æµ‹è¯•é‡‡æ ·ã€‚single-word 3minå·¦å³ï¼Œmulti-wordå¾—28minå¤šã€‚

ä¸”é‡‡æ ·åˆ°çš„æ ·æœ¬é‡Œï¼Œå­˜åœ¨ä¸‹åˆ—æƒ…å†µ

AFFæ ·æœ¬
S1: 
Sources disagree on the word's meaning.
S2:
Some scholars suggest the word comes from the Choctaw  (meaning 'plants' or 'weeds') and  (meaning 'to cut', 'to trim', or 'to gather').

S1ä¸­å‡ºç°äº†å¦å®šè¯ã€‚è¿™æ˜¯æ²¡æœ‰åŠæ³•é¿å…çš„ï¼Œå› ä¸ºdisagreeä¸å±äºcondaQAçš„é‚£219ä¸ªnegation cuesé‡Œï¼Œæ‰€ä»¥æ²¡æœ‰èƒ½è¢«æ£€æµ‹åˆ°ã€‚è¿™ä¸ªé—®é¢˜ï¼Œä¹‹å‰é—®è¿‡Edï¼Œå…¶è¯´äº†æ²¡å…³ç³»ã€‚è¿™ä¹Ÿæ˜¯æ— æ³•é¿å…çš„é—®é¢˜ã€‚Negå¥å­ä¹Ÿä¼šå‡ºç°ç±»ä¼¼çš„æƒ…å†µã€‚


è¿˜å­˜åœ¨ä¸‹é¢çš„ä¾‹å­ï¼š
S1:
Issues in Proto-Munda and Proto-Austroasiatic Nominal Derivation: The Bimoraic Constraint.
S2:
In Marlys A. Macken (ed.)

åŸå¥å¦‚ä¸‹ï¼š
Anderson, G. D. S., &Â Zide, N. H.Â (2002). Issues in Proto-Munda and Proto-Austroasiatic nominal derivation: The Bimoraic constraint. InÂ M. A. MackenÂ (Ed.)Â _Papers from the 10th Annual Meeting of the Southeast Asian Linguistics Society_Â (pp. 55â€“74). Tempe: Arizona State University, South East Asian Studies Program, Monograph Series Press.

è¿™ç§ä¹Ÿä¼šå­˜åœ¨çš„ã€‚éš¾ä»¥å®Œå…¨å»é™¤ï¼Œä»¥Edçš„æƒ³æ³•åº”è¯¥æ˜¯å…ˆä¸ç®¡è¿™äº›çš„ã€‚


è¦æ”¶é›†100kä¸ªNEGå¥å­å¯¹ï¼Œ100kä¸ªAFFå¥å­å¯¹ã€‚ä½ è§‰å¾—ç”¨ä»€ä¹ˆæ–¹å¼å­˜å‚¨æ¯”è¾ƒå¥½ï¼Ÿå½“å‰ä½¿ç”¨çš„æ˜¯csvï¼Œè¿™ä¸ªåˆé€‚å—ï¼Ÿä¸€èˆ¬è¿™ç§å¤§å‹æ•°æ®é›†ç”¨ä»€ä¹ˆå­˜ï¼Ÿ

**CSV å¯ä»¥ç”¨ï¼Œä½†å¹¶ä¸æ˜¯æœ€ä½³é€‰æ‹©**ã€‚  
å¤§è§„æ¨¡æ–‡æœ¬æ•°æ®é›†ï¼Œå°¤å…¶æ˜¯ NLP ä»»åŠ¡ä¸­ï¼Œé€šå¸¸ä¼šç”¨ **JSONLï¼ˆæ¯è¡Œä¸€ä¸ª JSONï¼‰** æˆ– **Parquet** æ ¼å¼æ¥å­˜å‚¨ã€‚

- **ä¸»å­˜å‚¨ï¼ˆæƒå¨ç‰ˆæœ¬ï¼‰**ï¼š`JSONL` + `gzip` å‹ç¼©ï¼ˆä¾‹å¦‚ `data.jsonl.gz`ï¼‰
    - ä¼˜ç‚¹ï¼š
        - å¯ä»¥å­˜ä»»æ„ç»“æ„ï¼ˆå­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å­—å…¸ç­‰ï¼‰
        - ä¸æ€•å¥å­ä¸­æœ‰é€—å·ã€æ¢è¡Œç­‰ç‰¹æ®Šå­—ç¬¦
        - æ–¹ä¾¿è¿½åŠ ã€æŒ‰è¡Œè¯»å–ã€åˆ†ç‰‡å­˜å‚¨
        - å¾ˆå¤š NLP å·¥å…·ï¼ˆæ¯”å¦‚ Hugging Face Datasetsï¼‰ç›´æ¥æ”¯æŒ
- **åˆ†æ/å¿«é€ŸåŠ è½½ç‰ˆæœ¬**ï¼š`Parquet`
    - ä¼˜ç‚¹ï¼š
        - åˆ—å¼å­˜å‚¨ï¼ŒåŠ è½½å’Œç­›é€‰é€Ÿåº¦æå¿«
        - å‹ç¼©æ¯”é«˜ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´
        - æ”¯æŒ Pandas / PyArrow / Polars ç­‰é«˜æ•ˆè¯»å–

**ä¸ºä»€ä¹ˆ CSV ä¸å¤ªé€‚åˆå¤§è§„æ¨¡ NLP æ•°æ®**
- CSV åªé€‚åˆ**å­—æ®µç»“æ„éå¸¸ç®€å•**ï¼ˆæ¯”å¦‚ `S1, S2, label`ï¼‰ï¼Œè€Œä¸”å­—æ®µå†…å®¹ä¸èƒ½å¤ªå¤æ‚ã€‚
- å¦‚æœå¥å­ä¸­å«æœ‰é€—å·ã€å¼•å·ã€æ¢è¡Œï¼Œå¿…é¡»è½¬ä¹‰ï¼Œå¦åˆ™å®¹æ˜“è§£æå‡ºé”™ã€‚
- æ‰©å±•å­—æ®µæ—¶ä¸æ–¹ä¾¿ï¼Œæ¯”å¦‚æœªæ¥æƒ³åŠ  `cue_type`ã€`paragraph_idx`ã€`source_title` ç­‰ä¿¡æ¯ï¼ŒCSV çš„å¯æ‰©å±•æ€§å·®ã€‚



### ä¿å­˜æ ¼å¼æ”¹è¿›
è™½ç„¶ `JSONL + gzip` æ˜¯å‹ç¼©æ ¼å¼ï¼Œä½†å®ƒæœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€è¡Œä¸€ä¸ª JSON æ–‡æœ¬ï¼Œä½ å¯ä»¥**éšæ—¶è§£å‹åç›´æ¥çœ‹**ï¼Œç”šè‡³**ä¸è§£å‹ä¹Ÿèƒ½ç›´æ¥æŸ¥çœ‹**ã€‚

gzip -d data.jsonl.gz   # è§£å‹å¾—åˆ° data.jsonl
less data.jsonl         # åˆ†é¡µæŸ¥çœ‹
head data.jsonl         # æŸ¥çœ‹å‰10è¡Œ

è§£å‹åï¼Œæ¯è¡Œå°±æ˜¯ä¸€æ¡æ ·æœ¬çš„ JSONï¼Œä¾‹å¦‚ï¼š
{"S1": "ä»Šå¤©å¤©æ°”çœŸå¥½", "S2": "æˆ‘æ‰“ç®—å‡ºå»èµ°èµ°", "label": "AFF", "cue": "NONE"}
{"S1": "He is not happy", "S2": "She tried to cheer him up", "label": "NEG", "cue": "not"}


ä¹Ÿå¯ä»¥pandasç›´æ¥è¯»å–æŸ¥çœ‹ï¼š
```Python
import pandas as pd

df = pd.read_json("data.jsonl.gz", lines=True, compression="gzip")
print(df.head())

```

è¿™æ ·ä½ å°±èƒ½åƒè¯» CSV ä¸€æ ·è¯»è¿› Pandas åšåˆ†æã€‚


### mainå‡½æ•°æ”¹è¿›ï¼Œé¿å…è¸© `streaming=True` çš„è¿­ä»£å™¨å¤ç”¨å‘ã€‚

```Python
if __name__ == "__main__":

start_time = time.time()

run_extraction_pipeline(
wiki_dataset=load_dataset("wikimedia/wikipedia", "20231101.en", split="train", streaming=True),
cue_csv_path="processed_data/classified_cues_manually_freq/single_negation_with_freq.csv",
all_cue_csv_path="processed_data/negation_cues_unique.csv",
total_neg_target=300,
min_per_cue=1,
neg_outfile="processed_data/extract_data_wiki/single_word_cues/neg_pairs_single_word.csv",
aff_outfile="processed_data/extract_data_wiki/single_word_cues/aff_pairs_single_word.csv"
)

end_time = time.time()
print(f"running time: {end_time - start_time:.4f} seconds")
```

**Hugging Face streaming çš„äºŒæ¬¡éå†**ï¼ˆé‡ç‚¹ï¼‰  
    ä½ çš„ pipeline é‡Œå…ˆè·‘ä¸€éæ NEG å’Œæœ¬ç¯‡å†… AFFï¼Œ**ç„¶å**å¦‚æœ AFF ä¸è¶³ï¼Œä¼šå†â€œä»å¤´éå†â€è¡¥é½ã€‚    

- ç”¨ `streaming=True` æ—¶ï¼Œ**æœ‰äº›**è¿­ä»£å™¨ä¸èƒ½å®‰å…¨äºŒæ¬¡éå†ï¼ˆå–å†³äºå®ç°å’Œä½ æ˜¯å¦æå‰æ¶ˆè´¹ï¼‰ã€‚ç¨³å¦¥èµ·è§ï¼Œ**è¡¥é½æ—¶é‡æ–°æ„é€ ä¸€ä¸ªæ–°çš„ dataset** å†éå†ä¸€æ¬¡æ›´å®‰å…¨ã€‚

**Hugging Face Datasets çš„ `streaming=True` è¿”å›çš„æ˜¯â€œå¯è¿­ä»£æµï¼ˆå•æ¬¡éå†ï¼‰â€**ï¼Œä¸æ˜¯å¯éšæœºè®¿é—®çš„æ•°æ®è¡¨ã€‚äºŒæ¬¡éå†æ—¶æœ€å®¹æ˜“è¸©å‘ã€‚

##### ä¼šå‡ºä»€ä¹ˆé—®é¢˜

1. **å•æ¬¡éå†**  
    æµå¼ `IterableDataset` é€šå¸¸æ˜¯â€œåªèƒ½å‘å‰è¯»â€çš„è¿­ä»£å™¨ã€‚ä½ ä¸€æ—¦æŠŠå®ƒæ¶ˆè€—å®Œï¼ˆæ¯”å¦‚ç¬¬ä¸€éæ NEG/AFFï¼‰ï¼Œ**æŒ‡é’ˆåˆ°æœ«å°¾**ï¼Œæƒ³â€œå†ä»å¤´æ¥ä¸€éâ€æ˜¯åšä¸åˆ°çš„ã€‚ç®€å•åœ°å†æ¬¡ `for sample in dataset:` ä¸ä¼šå›åˆ°å¼€å¤´ã€‚
    
2. **ä¸èƒ½ `len()`ã€ä¸èƒ½éšæœºç´¢å¼•**  
    `len(dataset)`ã€`dataset[i]`ã€éšæœºé‡‡æ ·/æ‰“ä¹±ï¼ˆé™¤éæœåŠ¡å™¨ç«¯æ”¯æŒï¼‰éƒ½ä¸å¯ç”¨ã€‚ä½ çš„è¡¥é½é€»è¾‘å¦‚æœæš—å«è¿™äº›æ“ä½œï¼Œä¼šç›´æ¥æŠ¥é”™æˆ–è¡Œä¸ºå¼‚å¸¸ã€‚
    
3. **å¤šè¿›ç¨‹/å¤šçº¿ç¨‹/é‡å¤æ¶ˆè´¹**  
    åŒä¸€ä¸ªæµè¢«å¤šä¸ªæ¶ˆè´¹è€…å¹¶å‘æˆ–è½®æµâ€œå†è·‘ä¸€éâ€ä¼šäº’ç›¸å¹²æ‰°ï¼Œå®¹æ˜“æ‹¿åˆ°ç©ºç»“æœæˆ–æŒ‚ä½ã€‚
    
4. **ç½‘ç»œä¸­æ–­ä¸ç¼“å­˜**  
    æµå¼è¯»å–ä¾èµ–è¿œç«¯å’Œç½‘ç»œã€‚ä½ è·‘ç¬¬äºŒéæ—¶ï¼Œæºæµå·²ç»è¢«æ¶ˆè´¹ï¼Œ**å¿…é¡»é‡æ–°å¼€ä¸€ä¸ªæ–°æµ**ï¼ˆé‡æ–° `load_dataset`ï¼‰ï¼Œå¦åˆ™æ²¡æœ‰æ•°æ®å¯è¯»ã€‚



ä½ è¯¥æ€ä¹ˆæ”¹?
æ ¸å¿ƒæ€è·¯ï¼š**ä¸è¦è®©è¡¥é½å‡½æ•°ä¾èµ–â€œè¿˜èƒ½ä»åŒä¸€ä¸ªæµå†è¯»ä¸€éâ€ã€‚** åœ¨ **pipeline å±‚** é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„æµï¼Œäº¤ç»™è¡¥é½å‡½æ•°æ¶ˆè´¹ã€‚

==æ¨èåšæ³•ï¼ˆåœ¨ pipeline é‡Œé‡è½½æµï¼‰==
åœ¨å‘ç°éœ€è¦è¡¥é½ AFF æ—¶ï¼Œ**é‡æ–° `load_dataset(..., streaming=True)`** æ‹¿ä¸€æ¡æ–°æµï¼Œä¼ ç»™ `extract_remaining_affirmative`ã€‚è¡¥é½å‡½æ•°ä¸ç”¨æ”¹ã€‚
```Python
if aff_count < total_neg_target:
        remaining_needed = total_neg_target - aff_count
        print(f"[ä¿¡æ¯] AFF ç¼ºå£: {remaining_needed}ï¼Œé‡æ–°åŠ è½½æµè¡¥é½...")
        ds2 = load_dataset("wikimedia/wikipedia", "20231101.en", split="train", streaming=True)
        # æˆ–è€…ä¼ ä¸€ä¸ªå·¥å‚å‡½æ•°è¿›æ¥ï¼šds2 = wiki_factory()
        aff_extra = extract_remaining_affirmative(ds2, remaining_needed, all_cue_set, seen_aff_pairs)
        neg_aff_data.extend(aff_extra)
```


æ–¹æ¡ˆäºŒï¼š==ä¼ å·¥å‚å‡½æ•°æ›´ä¼˜é›…==

æŠŠ `wiki_dataset` æ¢æˆä¸€ä¸ªâ€œ**æ•°æ®æºå·¥å‚**â€ï¼Œéœ€è¦æ–°æµå°±è°ƒä¸€æ¬¡
```Python
wiki_factory = lambda: load_dataset("wikimedia/wikipedia", "20231101.en", split="train", streaming=True)
```

ä¼˜ç‚¹ï¼šé…ç½®åœ¨ mainï¼Œpipeline é‡Œä¸éœ€è¦çŸ¥é“å…·ä½“åŠ è½½ç»†èŠ‚ã€‚**ä¼ ä¸€ä¸ª `wiki_factory`** ç»™ pipelineï¼Œéœ€è¦å‡ éå°±è°ƒå‡ æ¬¡ã€‚

æŠŠ `run_extraction_pipeline` æ”¹æˆ**æ¥æ”¶ä¸€ä¸ªâ€œæ•°æ®æºå·¥å‚â€ `wiki_factory`**ï¼Œéœ€è¦éå†ç¬¬äºŒéæ—¶å°±é‡æ–°æ‹¿ä¸€æ¡æ–°çš„æµï¼ˆé¿å… `streaming=True` çš„äºŒæ¬¡éå†å‘ï¼‰ã€‚é¡ºä¾¿æŠŠå®é™…æ•°é‡ç»Ÿè®¡ã€å…œåº•å‘Šè­¦ã€ç›®å½•åˆ›å»ºä¹Ÿä¸€å¹¶åšå¥½ã€‚

##### ä¸ºå•¥æ”¹åœ¨ pipeline è€Œä¸æ˜¯è¡¥å…¨å‡½æ•°é‡Œ

- **èŒè´£æ¸…æ™°**ï¼šè¡¥å…¨å‡½æ•°åªæ¶ˆè´¹â€œç»™å®ƒçš„é‚£æ¡æµâ€ï¼Œä¸å…³å¿ƒæ•°æ®æºå¦‚ä½•åˆ›å»ºã€‚
- **å¯æµ‹è¯•**ï¼špipeline ç»Ÿä¸€æ§åˆ¶é‡è½½ã€æ—¥å¿—ã€è®¡æ•°ä¸ä¿å­˜ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜ã€‚
- **å¯å¤ç”¨**ï¼šåŒæ ·çš„è¡¥å…¨å‡½æ•°åœ¨åˆ«çš„ pipeline æˆ–éæµå¼æ•°æ®ä¸Šä¹Ÿèƒ½å¤ç”¨ã€‚

è¿™æ ·æ”¹å®Œï¼Œä½ å°±èƒ½å®‰å…¨åœ°åšâ€œç¬¬äºŒééå†â€ï¼Œä¸ä¼šè¸© `streaming=True` çš„è¿­ä»£å™¨å¤ç”¨å‘ã€‚

åŒºåˆ«ï¼š
- ä»¥å‰ `wiki_dataset` æ˜¯ Hugging Face streaming datasetï¼ˆåªèƒ½é¡ºåºè¿­ä»£ä¸€æ¬¡ï¼‰
- ç°åœ¨ä½ æ”¹æˆ `wiki_factory()` è¿™ç§å¯å¤šæ¬¡è°ƒç”¨çš„å·¥å‚å‡½æ•°ï¼Œæ‰€ä»¥èƒ½å¤šæ¬¡éå†


ä½†æ˜¯é—®é¢˜åœ¨äºï¼š
- Hugging Face streaming çš„æ¯ä¸€æ¬¡éå†ï¼Œéƒ½æ˜¯**é‡æ–°è¯»å–ã€è§£å‹ã€è§£æ Wikipedia æ•°æ®**
    
- ä½ çš„æ•°æ®æ˜¯å¾ˆå¤§çš„ï¼ˆæ•´ä¸ª Wikipedia 2023 dumpï¼‰ï¼Œæ‰€ä»¥å³ä½¿é€»è¾‘æ²¡å˜ï¼Œå¤šä¸€æ¬¡è¯»å–éƒ½ä¼šè®©è¿è¡Œæ—¶é—´å¤§å¹…å¢åŠ 
    
- æ‰€ä»¥å˜æ…¢çš„åŸå› æ˜¯**ä½ ç°åœ¨äºŒæ¬¡éå†æ˜¯è´§çœŸä»·å®çš„å†è¯»ä¸€éå…¨é‡ Wikipedia**ï¼Œè€ŒåŸæ¥å¯èƒ½å› ä¸º streaming ç¼“å­˜æœºåˆ¶æˆ–æ•°æ®é‡æ²¡é‚£ä¹ˆå¤§ï¼Œæ„ŸçŸ¥ä¸æ˜æ˜¾


é‚£ä¹ˆæˆ‘ä¹‹å‰é‚£æ ·æ²¡æœ‰ä¿®æ”¹çš„æ—¶å€™ã€‚å…¶å®åœ¨è¡¥å…¨AFFçš„æ—¶å€™ï¼Œæ²¡æœ‰é‡æ–°åŠ è½½ä¸€éwikiæ•°æ®é›†æ˜¯å—ï¼Ÿå…¶å®å°±æ˜¯ç»§ç»­åœ¨å‘åè¯»å–ï¼Ÿæ¯”å¦‚æå–å¥å­å‡½æ•°é‚£å·²ç»éå†åˆ°ç¬¬100ç¯‡æ–‡ç« äº†ï¼Œæˆ‘éœ€è¦è¡¥AFFäº†ï¼Œè°ƒç”¨è¡¥å…¨å‡½æ•°ï¼Œå®é™…ä¸Šæ˜¯ä»ç¬¬101ç¯‡æ–‡ç« å¼€å§‹æ£€æµ‹æ˜¯å¦æœ‰åˆé€‚çš„å¥å­ï¼Ÿè€Œä¸æ˜¯ä»å¤´æ¥æ˜¯å—ï¼Ÿ

å¯¹ï¼Œä½ ç†è§£å¯¹äº†ã€‚
**ä¹‹å‰æ²¡æ”¹ streaming ç‰ˆæœ¬**æ—¶ï¼š

- `wiki_dataset` æ˜¯ Hugging Face çš„ streaming datasetï¼Œå®ƒå…¶å®æ˜¯ä¸€ä¸ª**ä¸€æ¬¡æ€§è¿­ä»£å™¨**
- ä½ åœ¨ `extract_balanced_neg_aff_pairs()` é‡Œå·²ç»æ¶ˆè€—åˆ°ç¬¬ 100 ç¯‡æ–‡ç« äº†
- å½“ä½ è°ƒç”¨ `extract_remaining_affirmative(wiki_dataset, â€¦)` æ—¶ï¼Œå®ƒå¹¶ä¸ä¼šâ€œä»å¤´æ¥â€ï¼Œè€Œæ˜¯**æ¥ç€ä»ç¬¬ 101 ç¯‡å¼€å§‹å¾€åè¯»**ï¼Œç›´åˆ°æ‰¾åˆ° enough AFF æˆ–è¯»åˆ°ç»“å°¾
- æ‰€ä»¥é‚£æ—¶å€™**å¹¶æ²¡æœ‰äºŒæ¬¡åŠ è½½æ•´ä¸ª Wikipedia**ï¼Œåªæ˜¯åœ¨åŒä¸€æ¬¡æµå¼éå†ä¸­ç»§ç»­å¾€åèµ°

è€Œä½ **ç°åœ¨æ”¹æˆ `wiki_factory()` ä¹‹å**ï¼š
- `extract_balanced_neg_aff_pairs()` å…ˆè°ƒç”¨äº†ä¸€æ¬¡ `wiki_factory()` â†’ è¯»äº†ä¸€éæ•°æ®
- è¡¥ AFF æ—¶ä½ åˆè°ƒç”¨äº†ä¸€æ¬¡ `wiki_factory()` â†’ è¿™ç›¸å½“äº**é‡æ–°å¼€äº†ä¸€æ¡æµï¼Œä»å¤´å†è¯»**ï¼Œæ‰€ä»¥æ—¶é—´æˆæœ¬ç¿»å€

è¿™ä¹Ÿæ˜¯ä½ ç°åœ¨è¿è¡Œæ—¶é—´å˜é•¿çš„ç›´æ¥åŸå› ã€‚

æˆ‘å»ºè®®ï¼š
- å¦‚æœä½ è¿˜æƒ³ä¿æŒ streaming ä¸€æ¬¡æ€§è¯»å–çš„é€Ÿåº¦ä¼˜åŠ¿ï¼Œé‚£å°±ä¸è¦æŠŠ dataset æ”¹æˆ factoryï¼Œè€Œæ˜¯**åœ¨ç¬¬ä¸€æ¬¡éå†æ—¶å°±æŠŠæ‰€æœ‰ AFF å€™é€‰æ”¾åˆ°ä¸€ä¸ªå…¨å±€æ± é‡Œ**
- è¿™æ ·å³ä½¿ç¬¬ä¸€è½® NEG/AFF æ•°é‡ä¸å¹³è¡¡ï¼Œä¹Ÿèƒ½ç›´æ¥åœ¨å†…å­˜æ± é‡Œè¡¥ AFFï¼Œä¸éœ€è¦å›å¤´å†è¯»

è‰¹.... é‚£å°±ä¸ä¿®æ”¹å°±å¥½äº†ï¼Œä¸ä¿®æ”¹æ²¡ä»€ä¹ˆå¤§é—®é¢˜ï¼Œå› ä¸ºæ˜¯è¡¥å…¨AFFï¼ŒAFFåº”è¯¥è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œä¸”wikiæœ‰6.4Mç¯‡æ–‡ç« ï¼Œæˆ‘æ‰“ç®—æå–AFF 1M, NEG 1Mï¼Œåº”è¯¥æ˜¯å¤Ÿçš„ã€‚

==ä¸ä¿®æ”¹è¿˜å¥½ä¸€äº›ï¼Œä¿®æ”¹äº†ä»¥åsingle-wordé‡‡æ ·300ä¸ªå˜ä¸º9minäº†ã€‚==

### æ³¨æ„

ç›®å‰çš„AFFå€™é€‰åˆ—è¡¨éšæœºæŒ‘é€‰æ ·æœ¬çš„é€»è¾‘é‡Œï¼Œè¿™ä¸ªéšæœºæ˜¯æ— æ³•å¤ç°çš„ï¼Œå› ä¸ºæ²¡æœ‰ä½¿ç”¨éšæœºç§å­ã€‚æˆ‘è§‰å¾—åº”è¯¥é—®é¢˜ä¹Ÿä¸å¤§ï¼Œæ¯”è¾ƒæ•°æ®é›†å‡†å¤‡å¥½äº†ï¼Œä»¥åå°±ä¼šå…¬å¼€çš„ï¼Œä¹Ÿä¸ä¼šé‡æ–°è·‘ï¼Œåˆ«äººä¹Ÿä¸éœ€è¦æ¥å¤ç°åˆ›å»ºæ•°æ®é›†çš„è¿‡ç¨‹ã€‚





### è®­ç»ƒé›†ï¼ŒéªŒè¯é›†ï¼Œæµ‹è¯•é›†

äºŒåˆ†ç±»ï¼ˆNEG vs AFFï¼‰ï¼Œæ€»æ ·æœ¬é‡å›ºå®šï¼ˆ200k å¥å­å¯¹ï¼‰ï¼Œæ‰€ä»¥éªŒè¯é›†å’Œæµ‹è¯•é›†çš„æ¯”ä¾‹è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š

1. **è®­ç»ƒéœ€è¦è¶³å¤Ÿå¤šçš„æ ·æœ¬**ï¼Œå¦åˆ™æ¨¡å‹å­¦ä¸åˆ°è§„å¾‹ã€‚
    
2. **éªŒè¯é›†ï¼ˆdev setï¼‰** ç”¨äºè°ƒè¶…å‚æ•°ã€æ—©åœï¼ˆearly stoppingï¼‰ï¼Œä¸èƒ½å¤ªå°ï¼Œå¦åˆ™ä¼°è®¡ä¸ç¨³å®šï¼›ä¹Ÿä¸èƒ½å¤ªå¤§ï¼Œå¦åˆ™æµªè´¹æœ¬å¯ä»¥è®­ç»ƒçš„æ ·æœ¬ã€‚
    
3. **æµ‹è¯•é›†ï¼ˆtest setï¼‰** åªåœ¨æœ€ç»ˆè¯„ä¼°æ—¶ä½¿ç”¨ï¼Œä¸èƒ½ç”¨æ¥è°ƒå‚æ•°ã€‚
    

---

## å¸¸è§åˆ†æ³•

|åˆ†æ³•æ¯”ä¾‹|è®­ç»ƒé›†|éªŒè¯é›†|æµ‹è¯•é›†|é€‚ç”¨åœºæ™¯|
|---|---|---|---|---|
|**80 / 10 / 10**|160k|20k|20k|æœ€å¸¸è§ï¼Œå¹³è¡¡è®­ç»ƒå’Œè¯„ä¼°éœ€æ±‚|
|**70 / 15 / 15**|140k|30k|30k|æ›´å¼ºè°ƒè¯„ä¼°ç¨³å®šæ€§ï¼ˆæµ‹è¯•é›†æ›´å¤§ï¼‰|
|**90 / 5 / 5**|180k|10k|10k|æ ·æœ¬æå¤šæ—¶ï¼Œå‡å°‘éªŒè¯/æµ‹è¯•å æ¯”|

---

## ç»“åˆä½ çš„æ•°æ®é‡ï¼ˆ100k NEG + 100k AFFï¼‰

æ€»æ ·æœ¬é‡ = 200k  
æˆ‘å»ºè®®å…ˆæŒ‰ **80/10/10** åˆ†ï¼Œå› ä¸ºï¼š

- è®­ç»ƒé›†ï¼š**160k**ï¼ˆ80k NEG + 80k AFFï¼‰ â†’ è¶³å¤Ÿè®­ç»ƒ
    
- éªŒè¯é›†ï¼š**20k**ï¼ˆ10k NEG + 10k AFFï¼‰ â†’ è¶…å‚æ•°è°ƒä¼˜ç¨³å®š
    
- æµ‹è¯•é›†ï¼š**20k**ï¼ˆ10k NEG + 10k AFFï¼‰ â†’ æœ€ç»ˆè¯„ä¼°æœ‰ç»Ÿè®¡æ„ä¹‰
    

è¿™æ ·å³ä¾¿åç»­æ‰©åˆ° 500k æ ·æœ¬ï¼Œä¹Ÿå¯ä»¥ä¿æŒåŒæ ·æ¯”ä¾‹ï¼Œç»“æœå¯æ¯”è¾ƒã€‚




wiki 20231101.en æ•°æ®é›†æœ‰6.4M row ä¹Ÿå°±æ˜¯æœ‰6.4Mæ–‡ç« ã€‚

æˆ‘ç›®å‰æ‰“ç®—åˆ›å»ºçš„æ•°æ®é›†ï¼Œ3ç§ç±»å‹ï¼Œå„2Mï¼ŸAFF 1M, NEG 1Mã€‚multi-wordæ€•æ˜¯æœ‰ç‚¹å›°éš¾ã€‚

single-wordåº”è¯¥æœ€å¿«ã€‚ç„¶åæ˜¯affixalã€‚

å„2Mæ ·æœ¬é‡çš„è¯ï¼Œä¸€å…±å°±æ˜¯6Mï¼Œä¹Ÿè¶³å¤Ÿå¤§äº†ã€‚Mohammedçš„æ–‡ç« ä¹Ÿå°±è®­ç»ƒåˆ°1Mã€‚è¿˜æ˜¯AFFå’ŒNEGä¸€èµ·1Mçš„æ•°æ®é‡ã€‚